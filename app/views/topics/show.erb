
<div class="show-all">
  <div class="show-main">
      <div class="topic-title"><strong><%= @topic.title %></strong></div>
    <% if @topic.images.present? %>
      <div class="show-photo">
        <% @topic.images.each do |image| %>
          <%= link_to image.url, 'data-lightbox': image do %>
            <%= image_tag image.url, height:"150px", width:"150px" ,class:"topic-image" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
    <div class="show-topic-comments">
      <div class="show-topic">
        <div class="topic-category"><%= @topic.category.name %></div>
        <div class="topic-text"><%= @topic.text %></div>
        <div class="topic-bottom">
          <div class="topic-delete">
            <% if user_signed_in? && @topic.user_id == current_user.id %>
              <%= link_to "トピックを削除する", topic_path(@topic.id), method: :delete, data: {confirm: '一度削除すると復旧はできません。 本当に削除しますか？'}, class:"date" %>
            <% end %>
          </div>
          <div class="topic-user">
            <% if user_signed_in? && current_user.liked_by?(@topic) %>
              <%= link_to topic_like_path(@topic), method: :DELETE, class:"good_after" do %>
                <%= image_tag 'good1.png', class:"good_icon" %>
                <%= @topic.likes.count %>
              <% end %>
            <% elsif user_signed_in? %>
              <%= link_to topic_likes_path(@topic), method: :POST, class:"good_before" do %>
                <%= image_tag 'good.png', class:"good_icon" %>
                <%= @topic.likes.count %>
              <% end %>
            <% else %>
              <%= link_to 'ログインしていいねする' , new_user_session_path %><%= @topic.likes.count %>
            <% end %>
            <% if user_signed_in? && current_user.baded_by?(@topic) %>
              <%= link_to topic_bad_path(@topic), method: :DELETE, class:"bad_after" do %>
                <%= image_tag 'bad1.png', class:"good_icon" %>
                <%= @topic.bads.count %>
              <% end %>
            <% else user_signed_in? %>
              <%= link_to topic_bads_path(@topic), method: :POST, class:"good_before" do %>
                <%= image_tag 'bad.png', class:"good_icon" %>
                <%= @topic.bads.count %>
              <% end %>
            <% end %>
            <% unless @topic.anonymous == true %>
              <%= image_tag @topic.user.image_url, class:"topic-icon" %>
              <div class="date">
                <%= time_ago_in_words(@topic.created_at) %>前<br>
                <%= @topic.user.nickname %>
              </div>
            <% else %>
              <div class="date">
                <%= time_ago_in_words(@topic.created_at) %>前<br> 
                ID: <%= @topic.user.public_uid %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="comment-main">
      <div class="comments">
        <% if @comments.present? %>
          <% @comments.each do |comments| %>
            <% if comments.type_id == 3 %>
              <div class="comment1">
                <% if comments.images.present? %>
                  <div class="show-photo">
                    <% comments.images.each do |image| %>
                      <%= link_to image.url, 'data-lightbox': image,class:"topic-image-link" do %>
                        <%= image_tag image.url, height:"100px", width:"100px" ,class:"topic-image" %>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
                <%= comments.comment %><br>
                <div class="comment-user">
                <div class="date">
                <% if user_signed_in? && comments.user_id == current_user.id %>
                  <%= link_to "コメントを削除する", topic_comment_path(comments.topic_id, comments.id), method: :delete, data: {confirm: '一度削除すると復旧はできません。 本当に削除しますか？'}, class:"date"%>
                  <% end %>
                  </div>
                    <div class="topic-date">
                    <% unless comments.anonymous == true %>
                      <%= image_tag comments.user.image_url, class:"topic-icon" %>
                      <div class="date">
                        <%= time_ago_in_words(comments.created_at) %>前<br>
                        <%= comments.user.nickname %>
                      </div>
                      <% else %>
                      <div class="date">
                        <%= time_ago_in_words(comments.created_at) %>前<br>
                        ID: <%= comments.user.public_uid %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% else %>
              <div class="comment2">
                <% if comments.images.present? %>
                  <div class="show-photo">
                    <% comments.images.each do |image| %>
                      <%= link_to image.url, 'data-lightbox': image,class:"topic-image-link" do %>
                        <%= image_tag image.url, height:"100px", width:"100px" ,class:"topic-image" %>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
                <%= comments.comment %><br>
                <div class="comment-user">
                  <div class="date">
                    <% if user_signed_in? && comments.user_id == current_user.id %>
                      <%= link_to "コメントを削除する", topic_comment_path(comments.topic_id, comments.id), method: :delete, data: {confirm: '一度削除すると復旧はできません。 本当に削除しますか？'}, class:"date"%>
                    <% end %>
                  </div>
                  <div class="topic-date">
                    <% unless comments.anonymous == true %>
                      <%= image_tag comments.user.image_url, class:"topic-icon" %>
                      <div class="date">
                        <%= time_ago_in_words(comments.created_at) %>前<br>
                        <%= comments.user.nickname %>
                      </div>
                      <% else %>
                      <div class="date">
                        <%= time_ago_in_words(comments.created_at) %>前<br>
                        ID: <%= comments.user.public_uid %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
        <div class="comment-none">
        この投稿にはまだコメントがありません。
        </div>
        <% end %>
      </div>
    </div>
    <div class="comment-form-main">
      <% if user_signed_in? %>
        <div class="comment-form">
          <%= form_with(model: [@topic,@comment],local: true) do |f| %>
            <%= render 'shared/error', model: f.object %>
            <label>
            <%= f.file_field :images, multiple: true, id: :topic_image, class:"f-file" %>
            <div class="previews" id="image-list">
              画像を選択<br>
              (最大4枚)
            </div>
            </label>
            <%= f.collection_select(:type_id, Type.all, :id, :name, {},{class: "f-type form"}) %>
            <%= f.text_area :comment, placeholder: "コメントを入力 (300文字以内)", class:"f-comment-text form" %>
            <div class="checkbox-comment">
              <%= f.label :anonymous, "匿名表示にする" %>
              <%= f.check_box :anonymous ,{checked: true}, "true", "false" %>
            </div>
            <%= f.submit "コメントを投稿する", class:"f-submit" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <%= render "shared/home" %>
  <%= render "shared/scroll" %>
</div>